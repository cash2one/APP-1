<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <!-- 优先使用 IE 最新版本和 Chrome -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <!-- 为移动设备添加 viewport -->
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <!-- 添加到主屏后的标题（iOS 6 新增） -->
    <meta name="apple-mobile-web-app-title" content="">
    <!-- 是否启用 WebApp 全屏模式，删除苹果默认的工具栏和菜单栏 -->
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <!-- 设置苹果工具栏颜色 -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <!-- 添加智能 App 广告条 Smart App Banner（iOS 6+ Safari） -->
    <meta name="apple-itunes-app" content="app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL">
    <!-- 忽略页面中的数字识别为电话，忽略email识别 -->
    <meta name="format-detection" content="telphone=no, email=no"/>
    <!--下面三个是清除缓存 微信浏览器缓存严重又无刷新；这个方法调试的时候很方便-->
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>个人中心</title>
    <link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/m_common.css"/>
    <link rel="stylesheet" type="text/css" href="css/m_account_index.css"/>
</head>
	<body>
		<div class="mui-content">
			<div class="top">
        	<img id="userimg" src="images/user.png" alt="用户头像" />
				<a id="settings"><number id="mobile"></number><i class="icon iconfont">&#xe63d;</i></a>
			</div>

			<div class="mui-row">
		        <div class="mui-col-sm-4 mui-col-xs-4">
		            <li class="first mui-table-view-cell">
		                <a>
		                    	累计收益（个）<br /><br /><span><number id="accu_income"></number></span>
		                </a>
		            </li>
		        </div>
		        <div class="mui-col-sm-4 mui-col-xs-4">
		            <li class="mui-table-view-cell">
		                <a>
		                    	剩余福币（个）<br /><br /><span><number id="balance"></number></span>
		                </a>
		            </li>
		        </div>
		        <div class="mui-col-sm-4 mui-col-xs-4">
		            <li class="mui-table-view-cell">
		                <a>
		                    	剩余积分<br /><br /><span><number id="scores"></number></span>
		                </a>
		            </li>
		        </div>
    		</div>

			<ul class="mui-table-view">
			        <li class="mui-table-view-cell">
			            <a class="icon-qiandai mui-navigate-right" href="account/m_account_charge.html">
			                 福币管理
			            </a>
			        </li>
			        <li class="mui-table-view-cell">
			            <a class="icon-jifen mui-navigate-right"  href="account/m_account_score.html">
			                 	积分管理
			            </a>
			        </li>

			</ul>
			<ul class="mui-table-view">
			        <li class="mui-table-view-cell">
			            <a class="icon-iconfontfuli mui-navigate-right"  href="account/m_account_welfare.html">
			                 	福利管理
			            </a>
			        </li>
			       <li class="mui-table-view-cell">
			            <a class="icon-youhuiquan mui-navigate-right"  href="account/m_account_coupon.html">
			                 	优惠券管理
			            </a>
			        </li>
			</ul>
			<ul class="mui-table-view">
			        <li class="mui-table-view-cell">
			            <a class="icon-fuligonglve mui-navigate-right"  href="account/m_strategy.html">
			                 	挖福利攻略
			            </a>
			        </li>
              <li class="mui-table-view-cell">
                  <a class="icon-yaoqing mui-navigate-right"  href="account/m_account_invite.html">
                        邀请好友
                  </a>
              </li>
			</ul>

		</div>
	<script type="text/javascript" charset="UTF-8" src="js/mui.min.js"></script>
	<script type="text/javascript" charset="UTF-8" src="js/UserInfo.js"></script>
    <script type="text/javascript" charset="utf-8">
      	mui.init();
      	var get_userinfo_url = "http://test.wafuli.cn/app/user/";
      	var self = null;
      	var tempview = null;
      	mui.plusReady(function() {
      		self = plus.webview.currentWebview();
      		self.addEventListener('show',function(){
      			if (!UserInfo.has_login()){
      				tologin();
      			}
      			else{
      				refresh_userinfo();
      			}
      		});
      		window.addEventListener('login-refresh',function(){
      			var info = UserInfo.userinfo();
      			display_userinfo(info);
      		});
      		window.addEventListener('logoff-refresh',function(){
      			display_userinfo();
      		});
      		function display_userinfo(dict){
      			if (!dict){
      				document.getElementById('userimg').src = "images/user.png";
					document.getElementById('mobile').innerText = "";
					document.getElementById('scores').innerText = "";
					document.getElementById('accu_income').innerHTML = "";
					document.getElementById('balance').innerText = "";
					document.getElementById('scores').innerText = "";
      			}
      			else{
      				var img = "images/user-0" + dict.userimg + ".png";
					document.getElementById('userimg').src = img;
					document.getElementById('mobile').innerText = dict.mobile;
					document.getElementById('scores').innerText = dict.scores;
					document.getElementById('accu_income').innerHTML = dict.accu_income;
					document.getElementById('balance').innerText = dict.balance
					document.getElementById('scores').innerText = dict.scores;
      			}
      		}
      		mui('.mui-table-view').on('tap', 'a', function(e) {
      			if (!UserInfo.has_login()){
      				tologin();
      			}
      			else{
      				if (!tempview){
      					tempview = plus.webview.getWebviewById("temp");
      				}
      				var targetTab = this.getAttribute('href');
      				tempview.loadURL(targetTab);
      				setTimeout(function(){
      					tempview.show('pop-in');
      				},10);
//    				console.log(tempview.id);
//					mui.openWindow({
//			            url: targetTab,
//			            id: targetTab,
//			            styles: {
//			                top: 0,
//			                bottom: 0,
//			                hardwareAccelerated:true
//			            },
//			            show:{
//					      autoShow:false,//页面loaded事件发生后自动显示，默认为true
//					      aniShow: 'slide-in-right'
//					    },
//			            waiting: {
//							autoShow: true,
//						},
//			        });
      			}
			});
			document.getElementById("settings").addEventListener("tap",function(e) {
				if (!UserInfo.has_login()){
      				tologin();
      			}
      			else{
      				tempview.loadURL("account/m_account_settings.html");
      				setTimeout(function(){
      					tempview.show('pop-in');
      				},10);
//					mui.openWindow({
//			            url: "account/m_account_settings.html",
//			            id: "account/m_account_settings.html",
//			            styles: {
//			                top: 0,
//			                bottom: 0,
//			                hardwareAccelerated:true
//			            },
//			            show:{
//					      autoShow:false,//页面loaded事件发生后自动显示，默认为true
//					      aniShow: 'slide-in-right'
//					    },
//			            waiting: {
//							autoShow: true,
//						},
//			        });
      			}
			});
			function tologin(){
				mui.openWindow({
		            url: "a_login.html",
		            id:"login",
		            styles: {
		                top: 0,
		                bottom: 0
		            },
		            show: {
		                aniShow: 'slide-in-right',
		            },
		            extras:{
		            	backid:self.id
		            }
		        });
			}
			function refresh_userinfo(){
				mui.ajax({
					type: "post",
					url: get_userinfo_url,
					dataType: 'json',
					data:{
		    			token:UserInfo.token()
		    		},
					success: function(ret) {
						if(ret.code==0){
							var info = ret.info;
							display_userinfo(info);
							UserInfo.userinfo(info);
	    				}
	    				else if(ret.code<0){
	    					mui.openWindow({
					            url: "a_login.html",
					            id:"login",
					            styles: {
					                top: 0,
					                bottom: 0,
					            },
					            show: {
					                aniShow: 'slide-in-right',
					            },
					            extras:{
					            	backid:self.id
					            }
					        });
					        return;
	    				}
	    				else{
	    					mui.alert(ret.msg);
	    				}
					},
					error:function(xhr,type,errorThrown){
						mui.alert(type);
					}
				});
			}
		});
    </script>
	</body>

</html>
